

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Generadores &mdash; documentación de Klear Tutorial - 1.0</title>
  

  
  
    <link rel="shortcut icon" href="../_static/klear.png"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../',
        VERSION:'1.0',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>

    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
    <link rel="top" title="documentación de Klear Tutorial - 1.0" href="../index.html"/>
        <link rel="up" title="REST" href="index.html"/>
        <link rel="next" title="application.ini" href="application.html"/>
        <link rel="prev" title="REST" href="index.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Klear Tutorial</a>
        <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Buscar documentos" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../environment/index.html">Instalación del entorno</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../environment/apache.html">Apache</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environment/php.html">PHP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environment/mysql.html">MySQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environment/phing.html">Phing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environment/zend.html">Zend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environment/klear.html">Klear</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../createProject/index.html">Creación del Proyecto</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../createProject/createEclipseProject.html">Crear el proyecto en Eclipse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../createProject/structure.html">Crear la estructura de directorios del proyecto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../createProject/zendProject.html">Crear proyecto Zend Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../createProject/klear.html">Configuración Klear</a></li>
<li class="toctree-l2"><a class="reference internal" href="../createProject/phing.html">Phing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../createProject/sqlsklear.html">SQLs Klear</a></li>
<li class="toctree-l2"><a class="reference internal" href="../createProject/generadoresDB.html">Generadores</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../joinProject/index.html">Unirse a un proyecto ya creado</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../joinProject/index.html#crear-un-proyecto-en-eclipse">Crear un proyecto en Eclipse</a></li>
<li class="toctree-l2"><a class="reference internal" href="../joinProject/index.html#obtener-el-proyecto">Obtener el proyecto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../joinProject/index.html#bases-de-datos">Bases de Datos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ini/index.html">Ficheros INI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ini/application-ini.html">application.ini</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ini/klear-ini.html">klear.ini</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../databases/index.html">Gestión de las Bases de Datos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../databases/phing.html">Phing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../databases/generator.html">Generador: Base de Datos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modelsMappers/index.html">Models y Mappers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modelsMappers/generator.html">Generador</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modelsMappers/models.html">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modelsMappers/mappers.html">Mappers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../yaml/index.html">Yaml</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../yaml/generator.html">Generador: Yaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yaml/klear-yaml.html">Klear.yaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yaml/general.html">Configuración general</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yaml/list.html">Configuración lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yaml/edit.html">Configuración edit/new</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yaml/dashboard.html">Configuración Dashboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yaml/charts.html">Configuración Googlecharts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yaml/fields/index.html">Tipos de Campos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yaml/dialogs.html">Dialogs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yaml/iconos.html">Iconos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../translate/index.html">Traducciones</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../translate/index.html#definicion-de-idiomas">Definición de idiomas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../translate/index.html#estructura-de-los-directorios">Estructura de los directórios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../translate/index.html#traduccion">Traducción</a></li>
<li class="toctree-l2"><a class="reference internal" href="../translate/index.html#poedit">Poedit</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../authCustom/index.html">Auth Custom</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../authCustom/roles.html">Roles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../authCustom/klear.html">Zona Klear</a></li>
<li class="toctree-l2"><a class="reference internal" href="../authCustom/public.html">Zona Pública</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../customScreen/index.html">Custom screen</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../customScreen/index.html#configuracion">Configuración</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dynamicConfigClass/index.html">Klear Dinámico</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dynamicConfigClass/index.html#ejemplo-klearintervals">Ejemplo klearIntervals</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../klearGallery/index.html">Klear Gallery</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../klearGallery/index.html#esquema-de-base-de-datos">Esquema de base de datos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../klearGallery/index.html#configuracion-de-la-galeria">Configuración de la Galería</a></li>
<li class="toctree-l2"><a class="reference internal" href="../klearGallery/index.html#integracion-con-wymeditor">Integración con wymeditor</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">REST</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Generadores</a></li>
<li class="toctree-l2"><a class="reference internal" href="application.html">application.ini</a></li>
<li class="toctree-l2"><a class="reference internal" href="bootstrap.html">Bootstrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="auth.html">Plugin de Autenticación</a></li>
<li class="toctree-l2"><a class="reference internal" href="restApi.html">restApi.ini</a></li>
<li class="toctree-l2"><a class="reference internal" href="htaccess.html">.htaccess</a></li>
<li class="toctree-l2"><a class="reference internal" href="controllers.html">Controllers</a></li>
<li class="toctree-l2"><a class="reference internal" href="docs.html">Documentación</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../fso/index.html">FSO</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../fso/index.html#fso-ini">fso.ini</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fso/index.html#config-life">config.life</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fso/index.html#config-routemap">config.routeMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fso/index.html#perfil-binay">Perfil Binay</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fso/index.html#perfil-basico-de-image">Perfil Basico de Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fso/index.html#comprimir-calidad-de-imagen">Comprimir calidad de imagen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fso/index.html#perfil-extendido">Perfil Extendido</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fso/index.html#perfiles-avanzados-de-image">Perfiles avanzados de Image</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">Klear Tutorial</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="../index.html">Docs</a> &raquo;</li>
  <li><a href="">Generadores</a></li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="../_sources/rest/generators.txt" rel="nofollow"> Ver origen</a>
      
    </li>
</ul>
<hr/>

          
  <div class="section" id="generadores">
<span id="rest-generator"></span><h1>Generadores<a class="headerlink" href="#generadores" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Si se quiere hacer de forma automatica la base de una <strong>Api REST</strong>, phing cuenta con una tarea llamada &#8220;<strong>generate-rest-controllers</strong>&#8221;
la cual necesita de un par de parametros en el <strong>application.ini</strong> y que las tablas que tendran controladores <strong>REST</strong> tengan el comentario &#8220;<strong>[rest]</strong>&#8221;.</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="na">restConfig.path</span> <span class="o">=</span> <span class="s">APPLICATION_PATH &quot;/modules/rest/&quot;</span>
<span class="na">restConfig.usersAuthTable</span> <span class="o">=</span> <span class="s">&quot;KlearUsers&quot;</span>
<span class="na">restConfig.fieldUsername</span> <span class="o">=</span> <span class="s">&quot;login&quot;</span>
<span class="na">restConfig.fieldPassword</span> <span class="o">=</span> <span class="s">&quot;pass&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>path</strong>: la ruta del modulo <strong>REST</strong>. <strong>(Aunque no se use el generador este parametro es obligatorio)</strong>.</li>
<li><strong>usersAuthTable</strong>: Nombre de la table de autenticación</li>
<li><strong>fieldUsername</strong>: Campo de identificacón del usuario</li>
<li><strong>fieldPassword</strong>: Campo de la contraseña del usuario</li>
</ul>
<p>Por otro lado, en la tabla que se usa para la autenticación, hay que añadir una columna tokenKey. Esta se utilizará para autenticar las peticiones de la API. Para generar el token a partir de la password, hay que declarar la password como PlainText en el yaml.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span>
   <span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ngettext(&#39;Password&#39;, &#39;Passwords&#39;, 1)</span>
   <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">password</span>
   <span class="l-Scalar-Plain">adapter</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">PlainText</span>
</pre></div>
</div>
<p>Y en el mapper hay que calcular el token cada vez que se modifica la password, y guardar esta cifrada para que no se almacene en texto plano.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">protected</span> <span class="k">function</span> <span class="nf">_save</span><span class="p">(</span><span class="nx">\Model\Raw\User</span> <span class="nv">$model</span><span class="p">,</span>
         <span class="nv">$recursive</span> <span class="o">=</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$useTransaction</span> <span class="o">=</span> <span class="k">true</span><span class="p">,</span> <span class="nv">$transactionTag</span> <span class="o">=</span> <span class="k">null</span>
 <span class="p">)</span>
 <span class="p">{</span>
     <span class="nv">$pass</span> <span class="o">=</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">hasChange</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">);</span>
     <span class="k">if</span> <span class="p">(</span><span class="nv">$pass</span><span class="p">)</span> <span class="p">{</span>
         <span class="nv">$passPlain</span> <span class="o">=</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">getPassword</span><span class="p">();</span>
         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$passPlain</span><span class="p">))</span> <span class="p">{</span>
             <span class="nv">$newToken</span> <span class="o">=</span> <span class="nb">md5</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nv">$passPlain</span><span class="p">));</span>
             <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">setTokenKey</span><span class="p">(</span><span class="nv">$newToken</span><span class="p">);</span>

             <span class="nv">$salt</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_salt</span><span class="p">();</span>
             <span class="nv">$ret</span> <span class="o">=</span> <span class="nb">crypt</span><span class="p">(</span>
                     <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">getPassword</span><span class="p">(),</span>
                     <span class="s1">&#39;$5$rounds=5000$&#39;</span> <span class="o">.</span> <span class="nv">$salt</span> <span class="o">.</span> <span class="s1">&#39;$&#39;</span>
             <span class="p">);</span>
             <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">setPassword</span><span class="p">(</span><span class="nv">$ret</span><span class="p">);</span>
             <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_logger</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="s2">&quot;Password Setted&quot;</span><span class="p">,</span> <span class="nx">\Zend_Log</span><span class="o">::</span><span class="na">INFO</span><span class="p">);</span>
         <span class="p">}</span>
     <span class="p">}</span>
     <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">_save</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="nv">$recursive</span><span class="p">,</span> <span class="nv">$useTransaction</span><span class="p">,</span> <span class="nv">$transactionTag</span><span class="p">);</span>

 <span class="p">}</span>

 <span class="k">protected</span> <span class="k">function</span> <span class="nf">_salt</span><span class="p">()</span>
 <span class="p">{</span>
     <span class="nv">$ret</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nx">mt_rand</span><span class="p">(),</span> <span class="k">false</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>

     <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
 <span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Entre las cosas que automatisa este generador, están:</dt>
<dd><ul class="first last simple">
<li>La generación de controladores con basicos con metodos funcionales</li>
<li>En cada metodo una serie de comentario, para una documentación con la librería &#8220;<strong>crada/php-apidoc</strong>&#8220;</li>
<li>Un plugin de autenticación por <strong>HEADER</strong>, que actualmente da soporte para <strong>Basic</strong> y <strong>HMAC</strong></li>
<li>El archivo &#8220;<strong>restApi.ini</strong>&#8221; que define que metodos necesitan autenticación</li>
</ul>
</dd>
</dl>
</div>


          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="application.html" class="btn btn-neutral float-right" title="application.ini"/>Siguiente <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="REST"><span class="icon icon-circle-arrow-left"></span> Anterior</a>
      
    </div>
  

  <hr/>

  <p>
      &copy; Copyright 2014, Irontec.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>